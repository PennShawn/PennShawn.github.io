---
title: MongoDB副本集(二)选举策略
categories: 
 - 技术
tags:
 - Java
 - MongoDB
---


为了提高MongoDB的可用性,我们一般会配置mongoDB副本集来实现单个数据库节点挂掉时的自动恢复功能.

和主从模式一样,MongoDB最少有3个节点,一主二从或者一主一从一仲裁者.<br>
当主节点故障之后,从节点间会选出一个新的主节点,选举算法是Bully算法.一个节点要成为主节点有以下几个条件:
- 首先它自己是可达的
- 优先级最高
- 在优先级相同的节点中opTime最新
- 有超过半数的节点活着并给它投票

##### 脑裂
脑裂是指某些情况下产生了多个主节点.<br>
比如有主1,从1,从2,从3四个节点,主1和从1在一个机房里,从2和从3在一个机房里,如果机房间因为网络问题无法相互连接了,从2从3会认为主节点故障了,重新选举出一个主节点.这样整个集群中就出现了两个主节点,这种情况就是脑裂.<br>
所以,我们集群一般是配置为超过半数节点同意才能为主节点.

4个节点的集群超过半数是3,5个节点的集群超过半数也是3,所以,我们集群的节点数一般配置成奇数个.
